---
title: "Living Review"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
---

```{r libraries and data, include=FALSE}
library(flexdashboard)
library(knitr)
library(DiagrammeR)
library(tidyverse)
library(googlesheets4)
library(plotly)
library(shiny)
library(formattable)
library(stringr)

# Get latest data; note: cannot connect to Google in application. Must save files locally.
# data <- read_sheet("https://docs.google.com/spreadsheets/d/1IyHoJpZiOV6_0soAgWqEoDCK4Uh9OnvxxaL0aRryN5M/edit#gid=0", sheet = "Data Extraction")
# data <- data %>% drop_na(Source)
# data.findings <- read_sheet("https://docs.google.com/spreadsheets/d/1IyHoJpZiOV6_0soAgWqEoDCK4Uh9OnvxxaL0aRryN5M/edit#gid=0", sheet = "Findings / Recs Spreadsheet")
# saveRDS(data, "data_extraction.Rds")
# saveRDS(data.findings, "data_findings.Rds")

data <- readRDS("data_extraction.Rds")
data.findings <- readRDS("data_findings.Rds")

data <- data %>% 
  mutate(ID = paste0(`Article ID`, `Study ID`)) %>%
  rename(
    cod_1 = 'Coder',
    cod_2 = 'Coder 2',
    int_1 = 'Int.', 
    int_2 = 'Int. 2', 
    ext_1 = 'Ext.', 
    ext_2 = 'Ext. 2', 
    dom_1 = 'Dom.',
    dom_2 = 'Dom. 2') %>% 
  mutate_at(vars(int_1:dom_2), ~ifelse(. == 0, 1, .)) %>% 
  mutate(int = (int_1 + int_2) / 2, 
         ext = (ext_1 + ext_2) / 2,
         dom = (dom_1 + dom_2) / 2)
```


```{css, echo = FALSE}
# This code chunk is necessary to make sure that the gauges on the "Core Findings" page are sized dynamically.
<style> .html-widget.gauge {
  height: 100%; 
}

.html-widget.gauge svg {
  height: 100%; 
  margin-top: 10px;
  margin-bottom: 40px;
} </style>
```

Executive Summary
=========================================

## Executive Summary

<center> **Living Systematic Review of Research on Communicating Probability Information** </center> 

**Motivation**

Probabilistic forecast information is rapidly proliferating, injecting in a new wave of uncertainty into the forecast and warning process. Most scientists agree that this is a positive development, but incorporating probability information into risk communication can be challenging, as probabilities are notoriously difficult to communicate effectively to lay audiences. What does the research literature say about the best way to include probability information in risk communication? What is the evidence base for different communication practices? This project endeavors to address these questions by conducting a living review of relevant research from past studies and new studies as they become available.

**Systematic Review**

A systematic review is a type of literature review that uses a transparent and replicable methodology to identify relevant research from past studies, evaluate results from those studies, and synthesize findings both qualitatively and quantitatively. Historically, systematic reviews have been static; they synthesize the literature at a point in time and become out-of-date almost as soon as they are complete. To prevent this, living systematic reviews are beginning to replace static reviews. Living reviews follow the same steps but are updated as new research becomes available.

Systematic reviews generally include some combination of the following steps:

1. Define the study domain
2. Search for and identify relevant studies
3. Extract key topics, questions, methods, and findings from relevant studies
4. Evaluate the quality of relevant studies
5. Analyze and combine the studies to identify common topics, questions, methods, and findings
6. Define confidence levels for common findings

This review includes one more step:

7. Assess common findings to develop recommendations to assist in communicating uncertainty and probabilities

**Steps in This Review**

***1. Define the study domain.*** In this review, we focus on research studies that examine the impact of probability information on risk comprehension and protective action decisions/intentions/behaviors. Most of these studies focus on the "best" or most effective way to communicate probability information. For example, are people more likely to take protective action when probability information is given verbally or numerically? Though extremely important, the review does not include studies that examine variation in risk or uncertainty perceptions alone. For example, it does not include studies on why some groups perceive high risk from hurricanes whereas others do not.

***2. Search for and identify relevant studies.*** Consistent with best practices, we use three iterative methods to search for and identify relevant studies: (1) electronic search databases; (2) other literature reviews; and (3) citation chains. We use three electronic search databases (ProQuest, Web of Science, and EBSCO Academic Search Elite) to search for studies about probabilistic risk/uncertainty communication in the weather and climate domain that use quantitative methodologies. At the start of this review, these searches resulted in 1,559 potentially relevant studies; 31 met the inclusion criteria---they were original research articles that fit the study domain. Next, we use other reviews of the literature to identify potentially relevant studies. To begin this review, we used 12 other reviews that mentioned 147 potentially relevant studies; 37 met the inclusion criteria for this review. Finally, we use citation chains to identify references IN and references TO relevant studies that we identify in electronic databases and other reviews. For example, we began this review by identifying 68 relevant studies in electronic databases and other reviews. There were 2,312 references IN the first set of relevant studies; 120 met the inclusion criteria. There were 3,268 references TO the first set of relevant studies; 140 met the inclusion criteria. In sum, we were able to find 324 unique studies to begin this review. Many of these studies report results from multiple studies. If the studies are sufficiently different (e.g., use a different sample, focus on a different topic), we treat them separately. So, though this review began with 324 complete studies (articles), we actually evaluate and analyze results from 509 distinct studies. Because this is a living systematic review, it is important to note that this is only the beginning of the review. We plan to repeat the steps above every 6 months to make sure that we are including the most up-to-date research.

```{r, fig.align = "center", fig.width = 7, fig.cap = "Fig. 1: Flow Diagram of the Search Relevant Studies"}
# mermaid("
# graph LR
# 1(<center>Electronic Databases<br>n = 31</center>) --> 3{<center>First Set<br>of Relevant<br>Studies<br>n = 68</center>}
# 2(<center>Literature Reviews<br>n = 38</center>) --> 3
# 3 --> 4(<center>References IN<br>n = 120</center>)
# 3 --> 5(<center>References TO<br>n = XXX</center>)
# 4 --> 6{<center>Second Set<br>of Relevant<br>Studies<br>n = XXX</center>}
# 5 --> 6
# 6 --> 7[<center>Total<br>Relevant<br>Studies<br>n = 504</center>]
# ")
include_graphics("flowchart.png")
```

***3. Extract key topics, questions, methods, and findings from relevant studies.*** We carefully look through each relevant study to extract key topic areas, research questions, research methods, and findings, and keep track of these details in a database.

***4. Evaluate the quality of relevant studies.*** We use three indicators of validity to assess the quality of each study: (1) external validity (are the results generalizable to the population of interest?); (2) internal validity (are we sure that variation in x causes variation in y?); and (3) domain validity (how relevant is the study domain to weather hazards and forecasting?). Each dimension is independently given a score by two researchers on a three point scale (1 = low; 2 = medium; 3 = high). We use the mean value of these scores to measure validity along each dimension and overall validity of each study.

***5. Analyze and combine the studies to identify common topics, questions, methods, and findings.*** We use the database of key topics, questions, methods, and findings from each study to identify commonalities across the relevant studies. Broadly, most of the studies that are currently in the review ask one of two research questions: (1) How does probability information impact risk comprehension? (2) How does probability information impact protective action decisions, intentions, and/or behaviors? A significant majority of the studies use survey research and quantitative analysis (statistics) to address these questions. Many of the studies employ survey experiments to compare the impact of one type of probability information (e.g., a slight chance of rain) to the impact of an alternative way of the present the same information (e.g., a 20% chance of rain). We are able to identify eight common topics that ten or more of the current relevant studies address. For example, the most common topic is Formats & Framing. Studies in this topic address key questions about how to present probabilities---as percentages, fractions, odds, etc. Many studies address multiple topics at once, such as Formats & Framing and Visualizations. Following topic identification, we identify core findings in each topic area. For example, a core finding in the Verbal Probability topic is: Do not assume that a verbal probability term or statement (such as very likely) will be interpreted the same way by everyone, as there is strong evidence that people interpret such terms much more ambiguously and heterogeneously than most realize. Verbal expressions describing probabilities close to 0%, 50%, and 100% are the least prone to such ambiguity. In most cases core findings receive support from multiple studies. In a select few instances, core findings may come from a single high-quality study.

***6. Define confidence levels for common findings.*** We use three indicators to provide confidence levels on each of the common findings: (1) consistency of evidence (do all studies say the same thing?); quantity of evidence (how many studies are there?); and quality of evidence (on average, how much validity do studies have?). Each dimension is given a score on a three point scale (1 = low; 2 = medium; 3 = high). We use the mean value of these scores to assess net confidence in each core finding.

***7. Assess common findings to develop recommendations to assist in communicating uncertainty and probabilities.*** This is the most difficult and subjective step in the systematic review. In this step, we work as a team to translate core findings into actionable recommendations. This is challenging because we have to decide which of the core findings are certain and relevant enough to support a recommendation. Relevancy is the primary challenge. Many studies in this review advance basic science but do not relate the findings to specific communication challenges. While valuable, it can be difficult to translate these findings into actionable advice for risk communicators. In addition, many studies in the review provide actionable advice on how to communicate probability in domains like healthcare. Again, the insight from these studies can be extremely valuable but difficult to translate into actionable advice for risk communicators who work in extreme weather/climate domains. This is where the subjectivity enters into the process. We pick the core findings that we believe are most relevant to risk communicators in extreme weather/climate domains below. We provide the core findings that we believe are certain and relevant enough to support tangible recommendations. We also include a communication example and example study for each recommendation. While we have extensive experience working with risk communicators in this domain, we cannot know or define everything that might be relevant. We therefore urge risk communicators to carefully examine core findings on their own to see if there might be something of relevance that we are missing in the list of recommendations.

Bibliographic Archive 
=========================================

**This page contains the complete bibliographic archive of all the studies we examined for this reivew. Click on a study in the table below to view the abstract, the subjective internal, external, and domain validity scores given to each study, and a link to the study's DOI page.**

Column 
-----------------------------------------------------------------------

### Study Name {.no-title .no-padding data-height=40}

<span style="color: #4682B4;"> **Study:** </span> `r renderText(select_react() %>% pull(var = Citation))` </font> 

### Study Details {.no-title data-height=175}

<span style="color: #4682B4;"> **Abstract:** </span> `r renderText(select_react() %>% pull(var = Abstract))`

<span style="color: #4682B4;"> **Internal Validity:** </span> `r renderText(select_react() %>% pull(var = int))`/3 | 
<span style="color: #4682B4;"> **External Validity:** </span> `r renderText(select_react() %>% pull(var = ext))`/3 | 
<span style="color: #4682B4;"> **Domain Validity:** </span> `r renderText(select_react() %>% pull(var = dom))`/3

<!-- Makes the DOI a hyperlink -->
<span style="color: #4682B4;"> **DOI:** </span> `r renderUI({a(select_react() %>% pull(var = DOI), href = paste0("https://doi.org/", select_react() %>% pull(var = DOI)))})`

### Bibliographic Archive {.no-title}
```{r}
# Renders the full list of studies. Also acts as the input for the Study Details table above.
font.size <- "10pt"
DT::datatable(data %>% select(Study, 
                              `Summary of Findings`, 
                              `Cited in Report`:`Not Cited`, 
                              `Internal Validity` = int, 
                              `External Validity` = ext, 
                              `Domain Validity` = dom) %>% 
                mutate_all(~str_replace_na(., "")) %>% 
                mutate(`Topic(s)` = paste(`Cited in Report`, `Cited in Report II`, `Cited in Report III`, `Not Cited`, sep = "; ")) %>% 
                mutate(`Topic(s)` = str_replace(`Topic(s)`, "; ; ; ", "")) %>%
                mutate(`Topic(s)` = str_replace(`Topic(s)`, "; ; ", "")) %>% 
                select(-c(`Cited in Report`:`Not Cited`)),
              filter = "top",
              selection = "single",
              rownames = FALSE,
              style = "bootstrap",
              class = "compact",
              options = list(dom = "Brtip", 
                             initComplete = htmlwidgets::JS("function(settings, json) {", 
                                                            paste0("$(this.api().table().container()).css({'font-size': '", 
                                                                   font.size, "'});"),"}")), # governs text size
              elementId = 'table1')

# This adds a new variable that indexes the position of each study in the dataset as it appears in the datatable. This is so that we can match the study up to the row number returned by input$table1_row_last_clicked later.

data <- data %>% mutate(tableNumber = c(1:nrow(data)))

# This creates the reactive version of our dataframe, w/ only the columns we want displayed. The if / else statement is there so that the default text is displayed before the user clicks a study on the datatable.

# select_react <- reactive({
# 
#   if(is.null(input$table1_row_last_clicked)){
#     
#     # This is the dataframe that is returned when input$table1_row_last_clicked = NA (on page load, before clicking the table)
#     data.frame(Study = "Click on one of the studies below to learn more!", 
#                Abstract = "None", 
#                DOI = "None", 
#                int = "0", 
#                ext = "0", 
#                dom = "0", 
#                stringsAsFactors = FALSE)
#     
#   } else {
#     
#   data %>%
#       filter(tableNumber == input$table1_row_last_clicked) %>%
#       select(Study, Abstract, DOI, int, ext, dom) %>% 
#       mutate(DOI = paste0("https://doi.org/", DOI))
#       
#   }
# })

# I usually try to populate things with the first observation to show readers what it looks like.

select_react <- reactive({

  if(
    
    is.null(input$table1_row_last_clicked)){
    data %>%
      filter(tableNumber == 1) %>%
      select(Study, Citation = `Full Citation`, Abstract, DOI, int, ext, dom)

  } else {

  data %>%
      filter(tableNumber == input$table1_row_last_clicked) %>%
      select(Study, Citation = `Full Citation`, Abstract, DOI, int, ext, dom)
  }
})
```

State of the Literature {.storyboard}
=========================================

**This page summarizes the state of the literature by plotting the percentage and mean validity of studies that address 5 primary and 14 secondary topics that are common in the literature. While this list of topics is likely to grow as the review continues, an examination of the relative frequency and validity of each topic provides valuable information about the *quantity* and *quality* of evidence we are able to identify in each topic area at a given point in time.**

### Percentage of studies that address primary topics of relevance.

```{r}
main_topics <- data %>% 
  select(ID = `Article ID`, `Cited in Report`:`Not Cited`) %>% 
  distinct(ID, .keep_all = TRUE) %>% 
  pivot_longer(`Cited in Report`:`Not Cited`) %>% 
  drop_na(value) %>% mutate(
    topic = case_when(
      value %in% c("Understanding Probability Information", 
                   "Probabilistic vs. Deterministic Information") ~ "(a) Public Understanding and\nUse of Probability Information\nin Decision Making",
      value %in% c("Numeric Translations of Words and Phrases", 
                   "Verbal Directionality and Reference Points", 
                   "Severity and Probability Conflation", 
                   "Choosing Words and Phrases") ~ "(b) Communicating Probability\nInformation Using Words\nand Phrases",
      value %in% c("Percentages", "Frequencies", 
                   "Reference Class Ambiguity", 
                   "Numeric Directionality and Reference Points") ~ "(c) Communicating Probability\nInformation Using Numbers",
      value %in% c("Non-Weather Visualizations", 
                   "Weather Visualizations", 
                   "General Visualization Advice", "") ~ "(d) Communicating Probability\nInformation Using Visualizations",
      value %in% c("Communicating to a Heterogeneous Population") ~ "(e) Communicating Probability\nInformation to a Heterogeneous\nPopulation")) %>% 
  filter(value != "Visualizations Intro")

main_topics$topic <- factor(main_topics$topic)
main_topics$topic <- factor(main_topics$topic, levels = rev(levels(main_topics$topic)))

main_freq_plot <- main_topics %>% 
  group_by(topic) %>% 
  summarise(n = n()) %>%
  drop_na() %>% 
  mutate(p = n / sum(n)) %>% 
  ggplot(., aes(y = topic, x = p, fill = topic, text = paste0(round(p * 100), "%"))) +
  geom_bar(stat = "identity") +
  scale_x_continuous(labels = scales::percent, limits = c(0, 0.3)) + 
  labs(x = "Studies in the Review") +
  theme_minimal(base_size = 10) +
  theme(axis.text.x = element_text(size = 10),
        axis.title.y = element_blank()) +
  guides(fill = FALSE) +
  scale_fill_manual(values = rev(viridis::cividis(5))) +
  theme(legend.position = 'none')

renderPlotly({
  ggplotly(main_freq_plot, tooltip = c("text"))
  })
```

### Percentage of studies within each primary topic that address secondary topics of relevance.

```{r}
secondary_topics <- data %>% 
  select(ID = `Article ID`, `Cited in Report`:`Not Cited`) %>% 
  distinct(ID, .keep_all = TRUE) %>% 
  pivot_longer(`Cited in Report`:`Not Cited`) %>% 
  drop_na(value) %>% 
  mutate(
    topic = case_when(
      value %in% c("Understanding Probability Information", 
                   "Probabilistic vs. Deterministic Information") ~ "(a) Public Understanding and Use of Probability Information in Decision Making",
      value %in% c("Numeric Translations of Words and Phrases", 
                   "Verbal Directionality and Reference Points", 
                   "Severity and Probability Conflation", 
                   "Choosing Words and Phrases") ~ "(b) Communicating Probability Information Using Words and Phrases",
      value %in% c("Percentages", 
                   "Frequencies", 
                   "Reference Class Ambiguity", 
                   "Numeric Directionality and Reference Points") ~ "(c) Communicating Probability Information Using Numbers",
      value %in% c("Non-Weather Visualizations", 
                   "Weather Visualizations", 
                   "General Visualization Advice", "") ~ "(d) Communicating Probability Information Using Visualizations",
      value %in% c("Communicating to a Heterogeneous Population") ~ "(e) Communicating Probability Information to a Heterogeneous Population")) %>% 
  mutate(sub_topic = case_when(
    value %in% c("Understanding Probability Information") ~ "(1) Understanding Probability Information", 
    value %in% c("Probabilistic vs. Deterministic Information") ~ "(2) Probabilistic vs. Deterministic Information",
    value %in% c("Numeric Translations of Words and Phrases") ~ "(1) Numeric Translations of Words and Phrases", 
    value %in% c("Verbal Directionality and Reference Points") ~ "(2) Directionality and Reference Points", 
    value %in% c("Severity and Probability Conflation") ~ "(3) Severity and Probability Conflation", 
    value %in% c("Choosing Words and Phrases") ~ "(4) Choosing Words and Phrases",
    value %in% c("Percentages") ~ "(1) Probabilities as Percentages", 
    value %in% c("Frequencies") ~ "(2) Probabilities as Frequencies", 
    value %in% c("Reference Class Ambiguity") ~ "(3) Reference Class Ambiguity", 
    value %in% c("Numeric Directionality and Reference Points") ~ "(4) Directionality and Reference Points",
    value %in% c("Non-Weather Visualizations") ~ "(1) Visualizations in Non-Weather Domains",
    value %in% c("Weather Visualizations") ~ "(2) Visualizations in Weather Domains",
    value %in% c("General Visualization Advice") ~ "(3) General Visualization Advice")) %>% 
  filter(value != "Visualizations Intro")

secondary_topics$topic <- factor(secondary_topics$topic)
secondary_topics$sub_topic <- factor(secondary_topics$sub_topic)
secondary_topics$sub_topic <- factor(secondary_topics$sub_topic, levels = rev(levels(secondary_topics$sub_topic)))

secondary_freq_plot <- secondary_topics %>% 
  group_by(topic, sub_topic) %>% 
  summarise(n = n()) %>%
  drop_na() %>% 
  mutate(p = n / sum(n)) %>% 
  ggplot(., aes(y = sub_topic, x = p, fill = topic, text = paste0(round(p * 100), "%"))) +
  geom_bar(stat = "identity") +
  scale_x_continuous(labels = scales::percent, limits = c(0, 0.7)) + 
  labs(x = "Studies in the Review") +
  theme_minimal(base_size = 10) +
  theme(axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 8),
        axis.title.y = element_blank(),
        strip.text = element_text(angle = 0, hjust = 0)) +
  guides(fill = FALSE) +
  facet_wrap(~topic, scales = "free_y", nrow = 4) +
  scale_fill_manual(values = viridis::cividis(5)[1:4]) +
  theme(legend.position = 'none')

renderPlotly({
  ggplotly(secondary_freq_plot, tooltip = c("text"))
  })
```

### Mean validity of studies that address primary topics of relevance.

```{r}
validity <- data %>% 
  select(ID = `Article ID`, int, ext, dom, `Cited in Report`, `Cited in Report II`, `Cited in Report III`, `Not Cited`) %>% 
  distinct(ID, .keep_all = TRUE) %>% 
  pivot_longer(`Cited in Report`:`Not Cited`) %>% 
  drop_na(value) %>% 
  mutate(
    topic = case_when(
      value %in% c("Understanding Probability Information", 
                   "Probabilistic vs. Deterministic Information") ~ "(1) Public Understanding and Use of\nProbability Information in Decision Making",
      value %in% c("Numeric Translations of Words and Phrases", 
                   "Verbal Directionality and Reference Points", 
                   "Severity and Probability Conflation", 
                   "Choosing Words and Phrases") ~ "(2) Communicating Probability Information\nUsing Words and Phrases",
      value %in% c("Percentages", 
                   "Frequencies", 
                   "Reference Class Ambiguity", 
                   "Numeric Directionality and Reference Points") ~ "(3) Communicating Probability\nInformation Using Numbers",
      value %in% c("Non-Weather Visualizations", 
                   "Weather Visualizations", 
                   "General Visualization Advice", "") ~ "(4) Communicating Probability\nInformation Using Visualizations",
      value %in% c("Communicating to a Heterogeneous Population") ~ "(5) Communicating Probability Information\nto a Heterogeneous Population")) %>% 
  mutate(topic = factor(topic, levels = c("(5) Communicating Probability Information\nto a Heterogeneous Population", 
                                          "(4) Communicating Probability\nInformation Using Visualizations",
                                          "(3) Communicating Probability\nInformation Using Numbers",
                                          "(2) Communicating Probability Information\nUsing Words and Phrases",
                                          "(1) Public Understanding and Use of\nProbability Information in Decision Making"))) %>% 
  mutate(sub_topic = case_when(
    value %in% c("Understanding Probability Information") ~ "(a) Understanding\nProbability\nInformation", 
    value %in% c("Probabilistic vs. Deterministic Information") ~ "(b) Probabilistic vs.\nDeterministic Information",
    value %in% c("Numeric Translations of Words and Phrases") ~ "(a) Numeric Translations\nof Words and Phrases", 
    value %in% c("Verbal Directionality and Reference Points") ~ "(b) Directionality and Reference Points", 
    value %in% c("Severity and Probability Conflation") ~ "(c) Severity and\nProbability Conflation", 
    value %in% c("Choosing Words and Phrases") ~ "(d) Choosing Words\nand Phrases",
    value %in% c("Percentages") ~ "(a) Probabilities\nas Percentages", 
    value %in% c("Frequencies") ~ "(b) Probabilities\nas Frequencies", 
    value %in% c("Reference Class Ambiguity") ~ "(c) Reference Class Ambiguity", 
    value %in% c("Numeric Directionality and Reference Points") ~ "(d) Directionality and\nReference Points",
    value %in% c("Non-Weather Visualizations") ~ "(a) Visualizations in\nNon-Weather Domains",
    value %in% c("Weather Visualizations") ~ "(b) Visualizations\nin Weather Domains",
    value %in% c("General Visualization Advice") ~ "(c) General Visualization\nAdvice")) %>% 
  filter(value != "Visualizations Intro")
  
means <- validity %>% 
  summarise(int = mean(int, na.rm = TRUE), ext = mean(ext, na.rm = TRUE), dom = mean(dom, na.rm = TRUE)) 
  
primary_valid_plot <- validity %>%
  group_by(topic) %>% 
  summarise(int = mean(int, na.rm = TRUE), ext = mean(ext, na.rm = TRUE), dom = mean(dom, na.rm = TRUE)) %>% 
  drop_na() %>% 
  mutate(ave = (int + ext + dom) / 3) %>% 
  ggplot(., aes(x = int, y = ext, size = dom, color = topic, 
                text = paste('Topic: ', topic,
                             '<br>Internal Validity:', round(int, 2), 
                             '<br>External Validity:', round(ext, 2),
                             '<br>Domain Validity:', round(dom, 2)))) + 
  geom_vline(xintercept = means$int, linetype = "dashed", alpha = 0.3) +
  geom_hline(yintercept = means$ext, linetype = "dashed", alpha = 0.3) +
  geom_point() +
  labs(x = "Internal Validity (Causality)", 
       y = "External Validity (Generalizability)", 
       caption = "Sizes of the points indicate mean domain validity") +
  theme_minimal(base_size = 10) +
  guides(color = FALSE, size = FALSE) +
  scale_size(range = c(10, 25)) +
  scale_color_manual(values = rev(viridis::cividis(5))) +
  theme(legend.position = 'none')

renderPlotly({
  ggplotly(primary_valid_plot, tooltip = c("text"))
  })
```

### Mean validity of studies within each primary topic that address secondary topics or relevance.

```{r}
secondary_valid_plot <- validity %>%
  group_by(topic, sub_topic) %>% 
  summarise(int = mean(int, na.rm = TRUE), ext = mean(ext, na.rm = TRUE), dom = mean(dom, na.rm = TRUE)) %>% 
  drop_na() %>% 
  mutate(topic = factor(topic, levels = rev(c("(5) Communicating Probability Information\nto a Heterogeneous Population", 
                                              "(4) Communicating Probability\nInformation Using Visualizations",
                                              "(3) Communicating Probability\nInformation Using Numbers",
                                              "(2) Communicating Probability Information\nUsing Words and Phrases",
                                              "(1) Public Understanding and Use of\nProbability Information in Decision Making")), 
         labels = rev(c("(5) Communicating Probability Information to a Heterogeneous Population", 
                        "(4) Communicating Probability Information Using Visualizations",
                        "(3) Communicating Probability Information Using Numbers",
                        "(2) Communicating Probability Information Using Words and Phrases",
                        "(1) Public Understanding and Use of Probability Information in Decision Making")))) %>% 
  ggplot(., aes(x = int, y = ext, size = dom, color = topic, 
                text = paste('Topic: ', sub_topic,
                             '<br>Internal Validity:', round(int, 2), 
                             '<br>External Validity:', round(ext, 2),
                             '<br>Domain Validity:', round(dom, 2)))) + 
  geom_vline(xintercept = means$int, linetype = "dashed", alpha = 0.3) +
  geom_hline(yintercept = means$ext, linetype = "dashed", alpha = 0.3) +
  geom_point() +
  labs(x = "Internal Validity (Causality)", 
       y = "External Validity (Generalizability)", 
       caption = "Sizes of the points indicate mean domain validity") +
  theme_minimal(base_size = 10) +
  guides(color = FALSE, size = FALSE) +
  scale_size(range = c(10 / 3, 25 / 3)) +
  facet_wrap(~topic) +
  scale_color_manual(values = viridis::cividis(5)[1:4]) +
  theme(legend.position = 'none')

renderPlotly({
  ggplotly(secondary_valid_plot, tooltip = c("text"))
  })
```


Core Findings {data-orientation=rows}
=========================================

**This page contains a complete list of the "core findings" we identified from among the materials in our systematic review. This list includes any finding that either 1) is identified and replicated consistently across multiple high-quality studies, 2) is identified by at least one study of extremely high quality, or 3) has easily identifiable potential utility for end-users of this review. As a result, some of these findings have less supporting evidence than others. Click on any of the core findings in the table below to view the supporting studies and their associated (subjective) internal, external, and domain validity scores.**

Row {data-height=100}
-----------------------------------------

### Finding {.no-title}
```{r}
renderText({
  finding_react() %>%
    pull(var = Recomendation)
})

```

Row {data-height=300}
-------------------------------------------

### Supporting Studies
```{r}
# Using renderTable() would be simpler and cleaner looking than a datatable, but I couldn't think of a way to get the DOI to display as a link without it 

# renderTable({
# 
# data %>%
#   filter(str_detect(toString(finding_react() %>% pull(var = 'Studies Cited')), data$`Full ID`)) %>%
#   mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) </a>")) %>%
#   select(Study, Link)
#         
# })

renderDataTable({

data %>%
  filter(str_detect(toString(finding_react() %>% pull(var = 'Studies Cited')), data$`Full ID`)) %>%
  mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
  select(Study, Link)
  
}, escape = FALSE, options = list(scrollY = '250px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
                   list(title = ""),
                   list(title = "")
                 )))

```


### Average Internal Validity
```{r}
renderGauge({
  temp <- data %>%
  filter(str_detect(toString(finding_react() %>% pull(var = 'Studies Cited')), data$`Full ID`)) %>%
  select(int, ext, dom) %>%
  summarise_all(mean)

  # I made all of the gauges go from 0-3 instead of from 1-3 because I think portaying 1 as absolute zero on the gauge implies that the study has zero credibility, which is not the case
  # I also think this might help us avoid the appearance of judging anyone's study as not credible or worthless, which might understandbly be offensive and isn't our intent
gauge(round(temp$int, 2), min = 0, max = 3, gaugeSectors(success = c(2.5, 3), warning = c(1.5, 2.5), danger = c(0, 1.5)))
}) 
```

### Average External Validity
```{r}
renderGauge({
  temp <- data %>%
  filter(str_detect(toString(finding_react() %>% pull(var = 'Studies Cited')), data$`Full ID`)) %>%
  select(int, ext, dom) %>%
  summarise_all(mean)
  
gauge(round(temp$ext, 2), min = 0, max = 3, gaugeSectors(success = c(2.5, 3), warning = c(1.5, 2.5), danger = c(0, 1.5)))
}) 
```

### Average Domain Validity
```{r}
renderGauge({
  temp <- data %>%
  filter(str_detect(toString(finding_react() %>% pull(var = 'Studies Cited')), data$`Full ID`)) %>%
  select(int, ext, dom) %>%
  summarise_all(mean)
  
gauge(round(temp$dom, 2), min = 0, max = 3, gaugeSectors(success = c(2.5, 3), warning = c(1.5, 2.5), danger = c(0, 1.5)))
}) 
```


Row
-----------------------------------------

### Complete List of Core Findings

```{r}

data.findings <- data.findings %>% mutate(tableNumber = c(1:nrow(data.findings)))

data.findings %>%
  select(Recomendation, Topic) %>%
  DT::datatable(., filter = "top",
              selection = "single",
              rownames = FALSE,
              style = "bootstrap",
              class = "compact",
              options = list(dom = "Brtip", 
                             initComplete = htmlwidgets::JS("function(settings, json) {", 
                                                            paste0("$(this.api().table().container()).css({'font-size': '", 
                                                                   font.size, "'});"),"}")), # governs text size
              elementId = 'findingTable')

finding_react <- reactive({

  if(
    
    is.null(input$findingTable_row_last_clicked)){
    data.findings %>%
      filter(tableNumber == 1) 

  } else {

  data.findings %>%
      filter(tableNumber == input$findingTable_row_last_clicked) 
  }
})

```


Practical Recommendations {.storyboard}
=========================================

### 1. Use probability information in lieu of deterministic information.

<font size=3.5px>

**Recommendation #1:** Use probability information in lieu of deterministic information.

**Example:** 

- **Replace**: These storms will cause heavy downpours and flooding.
- **With**: There is an extremely high (90%) chance that these storms will cause heavy downpours and flooding.


**Example Studies**: <a href = "https://doi.org/10.1037/a0025185">Joslyn & LeClerc (2012)</a> and <a href = "https://doi.org/10.1037/xap0000165">Grounds & Joslyn (2018)</a>

<br>
**All Relevant / Supporting Studies:** </font>

```{r}
cf1_studies <- data.findings %>%
  filter(ID == "124" | ID == "187" | ID == "196") 

renderDataTable({

data %>%
  filter(str_detect(toString(cf1_studies$'Studies Cited'), data$`Full ID`)) %>%
  mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
  select(Study, Link)
  
}, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
                   list(title = ""),
                   list(title = "")
                 )))
```

***

Commentary:

- The relevant text from the report goes here (edited to make sense in this format if needed).

### 2. Use probability ranges (predictive intervals) to emphasize uncertainty when point estimates are not available or appropriate; wide ranges indicate more uncertainty.

<font size=3.5px>

**Recommendation #2:** Use probability ranges (predictive intervals) to emphasize uncertainty when point estimates are not available or appropriate; wide ranges indicate more uncertainty. 

**Example:** 

- **Replace**: The forecast is rapidly evolving, but there is a slight (15%) chance that we will see more than 10 inches of snow in the metro area tomorrow morning.
- **With**: The forecast is rapidly evolving, but there is a slight (10% to 20%) chance that we will see more than 10 inches of snow in the metro area tomorrow morning.


**Example Studies**: <a href = "https://doi.org/10.1155/2017/3932565">Grounds et al (2017)</a> and <a href = "https://doi.org/10.1175/WCAS-D-18-0136.1">Løhre et al. (2019)</a>

<br>
**All Relevant / Supporting Studies:** </font>

```{r}
cf2_studies <- data.findings %>%
  filter(ID == "170" | ID == "171" | ID == "194" | ID == "116") 

renderDataTable({

data %>%
  filter(str_detect(toString(cf2_studies$'Studies Cited'), data$`Full ID`)) %>%
  mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
  select(Study, Link)
  
}, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
                   list(title = ""),
                   list(title = "")
                 )))
```

***

Commentary:

- The relevant text from the report goes here (edited to make sense in this format if needed).

### 3. Include numeric translations next to words / phrases that indicate probability information.

<font size=3.5px>

**Recommendation #3:** Include numeric translations next to words / phrases that indicate probability information.

**Example:** 

- **Replace**: Severe thunderstorms are possible this evening.
- **With**: With: Severe thunderstorms are possible (20% to 30% chance) this evening.


**Example Studies**: <a href = "https://doi.org/10.1038/nclimate2194">Budescu et al. (2014)</a>

<br>
**All Relevant / Supporting Studies:** </font>

```{r}
cf3_studies <- data.findings %>%
  filter(ID == "119" | ID == "120" | ID == "121") 

renderDataTable({

data %>%
  filter(str_detect(toString(cf3_studies$'Studies Cited'), data$`Full ID`)) %>%
  mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
  select(Study, Link)
  
}, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
                   list(title = ""),
                   list(title = "")
                 )))
```

***

Commentary:

- The relevant text from the report goes here (edited to make sense in this format if needed).

### 4. If comprehension is especially important, use numeric probabilities alone or first (before words/phrases). 

<font size=3.5px>

**Recommendation #4:** If comprehension is especially important, use numeric probabilities alone or first (before words/phrases). 

**Example:** 

- **Replace**: Severe thunderstorms are possible (20% to 30% chance) this evening.
- **With**: There is a 20% to 30% chance of thunderstorms this evening.


**Example Studies**: <a href = "https://doi.org/10.1002/bdm.2072">Jenkins et al. (2019)</a>

<br>
**All Relevant / Supporting Studies:** </font>

```{r}
cf4_studies <- data.findings %>%
   filter(ID == "119" | ID == "120" | ID == "121" | ID == "122") 

renderDataTable({

data %>%
  filter(str_detect(toString(cf4_studies$'Studies Cited'), data$`Full ID`)) %>%
  mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
  select(Study, Link)
  
}, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
                   list(title = ""),
                   list(title = "")
                 )))
```

***

Commentary:

- The relevant text from the report goes here (edited to make sense in this format if needed).

### 5. When using words and phrases to communicate probability information, include rank adjectives (like low, medium, and high) to indicate the magnitude of the probability; this is especially important if numeric translations are not available.

<font size=3.5px>

**Recommendation #5:** When using words and phrases to communicate probability information, include rank adjectives (like low, medium, and high) to indicate the magnitude of the probability; this is especially important if numeric translations are not available.

**Example:** 

- **Replace**: There is a chance of snow and ice this morning along I-75.
- **With**: There is a low/medium/high chance of snow and ice this morning along I-75.


**Example Studies**: <a href = "https://doi.org/10.15191/nwajom.2020.0805">Lenhardt et al. (2020)</a>

<br>
**All Relevant / Supporting Studies:** </font>

```{r}
# I think we probably need to sit down and create exhaustive / updated lists of all the studies relevant to each recommendation, then use that instead of the ones from data.findings
# This table and the one for Rec 12 will stay commented out since there's not really a way to do this for those recommendations until we make new lists

# cf5_studies <- data.findings %>%
#    filter(ID == "119" | ID == "120" | ID == "121" | ID == "122") 
# 
# renderDataTable({
# 
# data %>%
#   filter(str_detect(toString(cf5_studies$'Studies Cited'), data$`Full ID`)) %>%
#   mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
#   select(Study, Link)
#   
# }, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
#                    list(title = ""),
#                    list(title = "")
#                  )))
```

***

Commentary:

- The relevant text from the report goes here (edited to make sense in this format if needed).

### 6. Use probability (percentage) formats when possible; frequency (fraction) formats can be effective, but they can also generate confusion.

<font size=3.5px>

**Recommendation #6:** Use probability (percentage) formats when possible; frequency (fraction) formats can be effective, but they can also generate confusion.

**Example:** 

- **Replace**: There is a 1 in 10 chance that this storm will produce a tornado.
- **With**: There is a 10% chance that this storm will produce a tornado.


**Example Studies**: <a href = "https://doi.org/10.1177/0272989X08315246">Cuite et al. (2008)</a> and <a href = "https://doi.org/10.1002/met.121">Joslyn & Nichols (2009)</a>

<br>
**All Relevant / Supporting Studies:** </font>

```{r}
cf6_studies <- data.findings %>%
   filter(ID == "131" | ID == "132" | ID == "133" | ID == "134") 

renderDataTable({

data %>%
  filter(str_detect(toString(cf6_studies$'Studies Cited'), data$`Full ID`)) %>%
  mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
  select(Study, Link)
  
}, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
                   list(title = ""),
                   list(title = "")
                 )))
```

***

Commentary:

- The relevant text from the report goes here (edited to make sense in this format if needed).

### 7. When using frequency (fraction) formats, use 1 in X formats in place of X and NX formats.

<font size=3.5px>

**Recommendation #7:** When using frequency (fraction) formats, use 1 in X formats in place of X and NX formats.

**Example:** 

- **Replace**: Recent models indicate that there is a 20 in 100 chance that this storm will cause significant storm surge in the New Orleans area.
- **With**: Recent models indicate that there is a 1 in 5 chance that this storm will cause significant storm surge in the New Orleans area.


**Example Studies**: <a href = "https://doi.org/10.1177/0272989X11403490">Pighin et al. (2011)</a>

<br>
**All Relevant / Supporting Studies:** </font>

```{r}
cf7_studies <- data.findings %>%
   filter(ID == "135") 

renderDataTable({

data %>%
  filter(str_detect(toString(cf7_studies$'Studies Cited'), data$`Full ID`)) %>%
  mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
  select(Study, Link)
  
}, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
                   list(title = ""),
                   list(title = "")
                 )))
```

***

Commentary:

NOTE: This might get re-written; it's mostly here as a placeholder / example of how I want these pages to look. I intend to essentially copy / paste over the relevant paragraph(s) from our report into the commentary section of each practical recommendation.

Frequency formats, which present probabilistic information as a “1 in X” and “X in NX “ chance, have been found to influence risk comprehension in a number of ways. For example, Pighin, et al. (2015) assessed the effects of format ("1 in X" or "N in NX") on the interpretations of risk information. They observed that individuals had elevated perceptions of risk when shown the “1 in X” format as compared to the “N in NX format”. Interestingly, this was still true despite no observed effect on comprehension (Pighin et al. 2015). Oudhoff and Timmermans (2015) examined format and graphic effects on decisions to engage in risk-laden activities. They noted that the “1-in-X” format yielded higher perceived likelihoods and appeared to be the easiest format to interpret; however, graphs primarily affect perceptions of likelihood among people with lower numeracy (Oudhoff & Timmermans 2015). Denes-Raj, Epstein, and Cole (1995) investigated the effects of using a “1 in X” format compared to “N in NX” format in order to better understand how ratio bias plays a role in decision making. Their research suggested that although ratio bias is common, it is not ubiquitous across different situations (Denes-Raj, Epstein & Cole 1995). 

### 8. Include information about the reference class when using probability information.

<font size=3.5px>

**Recommendation #8:** Include information about the reference class when using probability information. 

**Example:** 

- **Replace**: There is a low chance of tornadoes in the Oklahoma City metro area tomorrow afternoon and evening.
- **With**: There is a low (2%) chance of tornadoes in the Oklahoma City metro area tomorrow afternoon and evening; on 1 in 50 days like today, there will be a tornado within 25 miles of your location.


**Example Studies**: <a href = "https://doi.org/10.1111/j.1539-6924.2005.00608.x">Gigerenzer et. al. (2005)</a> and <a href = "https://doi.org/10.1080/20445911.2018.1553884">Juanchich & Sirota (2018)</a>

<br>
**All Relevant / Supporting Studies:** </font>

```{r}
cf8_studies <- data.findings %>%
   filter(ID == "133" | ID == "153") 

renderDataTable({

data %>%
  filter(str_detect(toString(cf8_studies$'Studies Cited'), data$`Full ID`)) %>%
  mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
  select(Study, Link)
  
}, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
                   list(title = ""),
                   list(title = "")
                 )))
```

***

Commentary:

- The relevant text from the report goes here (edited to make sense in this format if needed).

### 9. Be aware of “directionality” when using probability information; positive frames can promote comprehension by encouraging people to focus on the events that are most likely to happen, whereas negative frames can promote risk aversion by encouraging people to focus on the possibility of negative events, even if they are unlikely.

<font size=3.5px>

**Recommendation #9:** Be aware of “directionality” when using probability information; positive frames can promote comprehension by encouraging people to focus on the events that are most likely to happen, whereas negative frames can promote risk aversion by encouraging people to focus on the possibility of negative events, even if they are unlikely. 

**Example:** 

- **Replace**: There is a high (90%) chance of sunny skies today.
- **With**: There is a low (10%) chance of freezing drizzle today.


**Example Studies**: <a href = "https://doi.org/10.1080/17470218.2016.1225779">Honda & Yamagishi (2017)</a> and <a href = "https://doi.org/10.1006/obhd.1999.2857">Teigen & Brun (2003)</a>

<br>
**All Relevant / Supporting Studies:** </font>
```{r}
cf9_studies <- data.findings %>%
  filter(ID == "107") 

renderDataTable({

data %>%
  filter(str_detect(toString(cf9_studies$'Studies Cited'), data$`Full ID`)) %>%
  mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
  select(Study, Link)
  
}, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
                   list(title = ""),
                   list(title = "")
                 )))
```

***

Commentary:

- The relevant text from the report goes here (edited to make sense in this format if needed).

### 10. When possible, include probability information in forecast visualizations.

<font size=3.5px>

**Recommendation #10:** When possible, include probability information in forecast visualizations. 

**Example:** 

- **Replace**: Maps showing deterministic warning boxes/polygons.
- **With**: Maps showing probabilistic information; for example: probability grids (FACETs); Potential Storm Surge Flooding map (NHC).


**Example Studies**: <a href = "https://doi.org/10.1175/WCAS-D-18-0094.1">Gerst et al. (2020)</a>

<br>
**All Relevant / Supporting Studies:** </font>

```{r}
cf10_studies <- data.findings %>%
   filter(ID == "191" | ID == "209") 

renderDataTable({

data %>%
  filter(str_detect(toString(cf10_studies$'Studies Cited'), data$`Full ID`)) %>%
  mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
  select(Study, Link)
  
}, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
                   list(title = ""),
                   list(title = "")
                 )))
```

***

Commentary:

- The relevant text from the report goes here (edited to make sense in this format if needed).

### 11. Use visualizations to increase comprehension of probability information; icon arrays and ensemble plots can be especially effective when teaching people how to interpret probability information. Note: this might not be appropriate immediately before or during high impact events.

<font size=3.5px>

**Recommendation #11:** Use visualizations to increase comprehension of probability information; icon arrays and ensemble plots can be especially effective when teaching people how to interpret probability information. Note: this might not be appropriate immediately before or during high impact events.

**Example:** 

- **Replace**: Models indicate that there is an 80% to 90% chance that hurricane force winds will affect Miami, FL in the next 5 days.
- **With**: 


**Example Studies**: <a href = "https://doi.org/10.1177/1473871618807121">Toet et al. (2019)</a> and <a href = "https://doi.org/10.1002/bdm.1797">Garcia-Retamero & Cokely (2014)</a>

<br>
**All Relevant / Supporting Studies:** </font>

```{r}
cf11_studies <- data.findings %>%
   filter(ID == "207" | ID == "208" | ID == "212") 

renderDataTable({

data %>%
  filter(str_detect(toString(cf11_studies$'Studies Cited'), data$`Full ID`)) %>%
  mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
  select(Study, Link)
  
}, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
                   list(title = ""),
                   list(title = "")
                 )))
```

***

Commentary:

- The relevant text from the report goes here (edited to make sense in this format if needed).

### 12. Pay attention to the audience when using probability information; most people are able to grasp basic probability information, but a lot depends on numeracy and experience.

<font size=3.5px>

**Recommendation #12:** Pay attention to the audience when using probability information; most people are able to grasp basic probability information, but a lot depends on numeracy and experience.

**Example Studies**: <a href = "https://doi.org/10.1111/disa.12293">Wernstedt et al. (2018)</a> and <a href = "https://doi.org/10.1111/j.1539-6924.2009.01279.x">Dieckmann et al. (2009)</a>

<br>
**All Relevant / Supporting Studies:** </font>

```{r}
# cf12_studies <- data.findings %>%
#    filter(ID == "") 
# 
# renderDataTable({
# 
# data %>%
#   filter(str_detect(toString(cf12_studies$'Studies Cited'), data$`Full ID`)) %>%
#   mutate(Link = paste0('<a href = "https://doi.org/', DOI, '">Link to Article</a>')) %>%
#   select(Study, Link)
#   
# }, escape = FALSE, options = list(scrollY = '500px', paging = FALSE, ordering = FALSE, searching = FALSE, dom = "t", columns = list(
#                    list(title = ""),
#                    list(title = "")
#                  )))
```

***

Commentary:

- The relevant text from the report goes here (edited to make sense in this format if needed).