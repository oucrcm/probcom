---
title: "Living Review"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
---

```{r libraries and data, include=FALSE}
library(flexdashboard)
library(knitr)
library(DiagrammeR)
library(tidyverse)
library(googlesheets4)
library(plotly)
library(shiny)
library(formattable)

 data <- read_sheet("https://docs.google.com/spreadsheets/d/1IyHoJpZiOV6_0soAgWqEoDCK4Uh9OnvxxaL0aRryN5M/edit#gid=0", sheet = "Data Extraction")
 data <- data %>% drop_na(Source)

 data.findings <- read_sheet("https://docs.google.com/spreadsheets/d/1IyHoJpZiOV6_0soAgWqEoDCK4Uh9OnvxxaL0aRryN5M/edit#gid=0", sheet = "Findings / Recs Spreadsheet")
 
# saveRDS(data, "database.Rds")
# data <- readRDS("database.Rds")

data$`Formats / Framing` <- ifelse(str_detect(data$`Topic(s)`, "Formats / Framing"), 1, 0)
data$`Verbal Expressions` <- ifelse(str_detect(data$`Topic(s)`, "Verbal Expressions"), 1, 0)
data$`Visualizations` <- ifelse(str_detect(data$`Topic(s)`, "Visualizations"), 1, 0)
data$`General Understanding` <- ifelse(str_detect(data$`Topic(s)`, "General Understanding"), 1, 0)
data$`Prob. vs. Det.` <- ifelse(str_detect(data$`Topic(s)`, "Prob. vs. Det."), 1, 0)
data$`Opinions / Perceptions` <- ifelse(str_detect(data$`Topic(s)`, "Opinions / Perceptions"), 1, 0)
data$`Small / Long-term risk` <- ifelse(str_detect(data$`Topic(s)`, "Small / Long-term risk"), 1, 0)
data$`Affect / Emotion` <- ifelse(str_detect(data$`Topic(s)`, "Affect / Emotion"), 1, 0)
data$`Other / Misc.` <- ifelse(str_detect(data$`Topic(s)`, "Other / Misc."), 1, 0)

data <- data %>% 
  rename(
    cod_1 = 'Coder',
    cod_2 = 'Coder 2',
    int_1 = 'Int.', 
    int_2 = 'Int. 2', 
    ext_1 = 'Ext.', 
    ext_2 = 'Ext. 2', 
    dom_1 = 'Dom.',
    dom_2 = 'Dom. 2') %>% 
  mutate_at(vars(int_1:dom_2), ~ifelse(. == 0, 1, .)) %>% 
  mutate(int = (int_1 + int_2) / 2, 
         ext = (ext_1 + ext_2) / 2,
         dom = (dom_1 + dom_2) / 2)
```

Executive Summary
=========================================

## Executive Summary

<center> **Living Systematic Review of Research on Communicating Probability Information** </center> 

**Motivation**

Probabilistic forecast information is rapidly proliferating, injecting in a new wave of uncertainty into the forecast and warning process. Most scientists agree that this is a positive development but incorporating probability information into risk communication can be challenging because probabilities are notoriously difficult to communicate effectively to lay audiences. What does the research literature say about the "best" way to include probability information in risk communication? What is the evidence base for different practices? This project endeavors to address these questions by conducting a **living [systematic review](https://en.wikipedia.org/wiki/Systematic_review)** of relevant research from past studies and new studies as they become available.

**Systematic Review**

A systematic review is type of literature review that uses a transparent and replicable methodology to identify relevant research from past studies, evaluate results from those studies, and synthesize findings both qualitatively and quantitatively. Historically systematic reviews have been static; they synthesize the literature at a point in time and become out-of-date almost as soon as they are complete. To prevent this, "[living systematic reviews](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3928029)" are beginning to replace static reviews. Living reviews follow the same steps but are updated as new research becomes available.

Systematic reviews generally include some combination of the following steps:

1. Define the study domain
2. Search for and identify relevant studies
3. Extract key topics, questions, methods, and findings from relevant studies
4. Evaluate the quality of relevant studies
5. Analyze and combine the studies to identify common topics, questions, methods, and findings
6. Define confidence levels for common findings

This review includes one more step:

7. Assess common findings to develop recommendations to assist in communicating uncertainty and probabilities

**Steps in This Review**

***1. Define the study domain.*** In this review, we focus on research studies that examine the impact of probability information on risk comprehension and protective action decisions/intentions/behaviors. Most of these studies focus on the "best" or most effective way to communicate probability information. For example, are people more likely to take protective action when probability is given verbally or numerically? Though extremely important, the review does not include studies that examine variation in risk or uncertainty perceptions alone. For example, it does not include studies on why some groups percieve high risk from hurricanes whereas others do not.

***2. Search for and identify relevant studies.*** Consistent with best practices, we use three iterative methods to search for and identify relevant studies: (1) electronic search databases; (2) other literature reviews; and (3) citation chains. We use three electronic search databases (ProQuest, Web of Science, and EBSCO Academic Search Elite) to search for studies about probabilistic risk/uncertainty communication in the weather and climate domain that use quantitative methodologies. At the start of this review, these searches resulted in 1,559 potentially relevant studies; 31 met the inclusion criteria---they were original research articles that fit the study domain. Next, we use other reviews of the literature to identify potentially relevant studies. To begin this review, we used 12 other reviews that mentioned 147 potentially relevant studies; 37 met the inclusion criteria for this review. Finally, we use citation chains to identify references IN and references TO relevant studies that we identify in electronic databases and other reviews. For example, we began this review by identifying 68 relevant studies in electronic databases and other reviews. There were 2,312 references In the first set of relevant studies; 120 met the inclusion criteria. There were 3,268 references TO the first set of relevant studies; XXX met the inclusion criteria. In sum, we were able to find XXX unique studies to begin this review. Many of these studies report results from multiple studies. If the studies are sufficiently different (e.g., use a different sample, focus on a different topic), we treat them separately. So, though this review began with XXX complete studies, we actually evaluate and analyze results from **504** distinct studies. Because this is a living systematic review, it is important to note that this is only the beginning of the review. We plan to repeat the steps above every 6 months to make sure that we are including the most up-to-date research.

```{r, fig.align = "center", fig.width = 7, fig.cap = "Fig. 1: Flow Diagram of the Search Relevant Studies"}
# mermaid("
# graph LR
# 1(<center>Electronic Databases<br>n = 31</center>) --> 3{<center>First Set<br>of Relevant<br>Studies<br>n = 68</center>}
# 2(<center>Literature Reviews<br>n = 38</center>) --> 3
# 3 --> 4(<center>References IN<br>n = 120</center>)
# 3 --> 5(<center>References TO<br>n = XXX</center>)
# 4 --> 6{<center>Second Set<br>of Relevant<br>Studies<br>n = XXX</center>}
# 5 --> 6
# 6 --> 7[<center>Total<br>Relevant<br>Studies<br>n = 504</center>]
# ")
include_graphics("flowchart.png")
```

***3. Extract key topics, questions, methods, and findings from relevant studies.*** We carefully look through each relevant study to extract key topic ares, research questions, research methods, and findings and keep track of these details in a database that is available [here](https://docs.google.com/spreadsheets/d/1IyHoJpZiOV6_0soAgWqEoDCK4Uh9OnvxxaL0aRryN5M/edit#gid=0). The [Bibliographic Archive] tab provides a searchable summary of key information about each study in the review.

***4. Evaluate the quality of relevant studies.*** We use three indicators of validity to assess the quality of each study: (1) external validity (are the results generalizable to the population of interest?); (2) internal validity (are we sure that variation in *x* causes variation in *y*?); and (3) domain validity (how relevant is the study domain to weather hazards and forecasting?). Each dimension is independently given a score by two researchers on a three point scale (1 = low; 2 = medium; 3 = high). We use the mean value of these scores to measure validity along each dimension and overall validity of each study. The [Bibliographic Archive] tab displays the mean scores for each study in the review.

***5. Analyze and combine the studies to identify common topics, questions, methods, and findings.*** We use the database of key topics, questions, methods, and findings from each study to identify common questions, methods, topics, and findings across the relevant studies. Broadly, most of the studies that are currently in the review ask one of two research questions: (1) How does probability information impact risk comprehension? (2) How does probability information impact protective action decisions, intentions, and/or behaviors? A significant majority of the studies use survey research and quantitative analysis (statistics) to address these questions. Many of the studies employ survey experiments to compare the impact of one type of probability information (e.g., a slight chance of rain) to the impact of an alternative way of the present the same information (e.g., a 20% chance of rain). We are able to identify eight common topics that ten or more of the current relevant studies address. For example, the most common topic is *Formats & Framing*. Studies in this topic are address key questions about how to present probabilities --- as percentages, fractions, odds, etc. The [State of the Literature] tab describes all 8 topics and provides information about the proportion of relevant studies that addressed each one. Many studies address multiple topics at once, such as *Formats & Framing* and *Visualizations*. Following topic identification, we identify core findings in each topic area. For example, a core finding in the *Verbal Probability* topic is: *Do not assume that a verbal probability term or statement (such as very likely) will be interpreted the same way by everyone, as there is strong evidence that people interpret such terms much more ambiguously and heterogeneously than most realize. Verbal expressions describing probabilities close to 0%, 50%, and 100% are the least prone to such ambiguity.* In most cases core findings receive support from multiple studies. In a select few instances, core findings may come from a single high quality study. The [Core Findings] tab lists core findings by topic area from the studies that are currently in the the review. These lists will evolve as we update the review with new research.

***6. Define confidence levels for common findings.*** We use three indicators to provide confidence levels on each of the common findings: (1) consistency of evidence (do all studies say the same thing?); quantity of evidence (how many studies are there?); quality of evidence (on average, how much validity do studies have?). Each dimension is given a score on a three point scale (1 = low; 2 = medium; 3 = high). We use the mean value of these scores to assess net confidence in each core finding. The [Core Findings] tab displays these scores for each core finding. These scores are likely to change as we update the review with new research.

***7. Assess common findings to develop recommendations to assist in communicating uncertainty and probabilities.*** This is the most difficult and subjective step in the systematic review. In this step, we work as a team to translate core findings into *actionable* recommendations. This is challenging because we have to decide which of the core findings are certain and relevant enough to support a recommendation. Relevancy is the primary challenge. Many studies in this review advance basic science but do not relate the findings to specific communication challenges. While valuable, it can be difficult to translate these findings into actionable advice for risk communicators. In addition, many studies in the review provide actionable advice on how to communicate probability in domains like healthcare. Again the insight from these studies can be extremely valuable but difficult to translate into actionable advice for risk communicators who work in extreme weather/climate domains. This is where the subjectivity enters into the process. We pick the core findings that we believe are most relevant to risk communicators in extreme weather/climate domains. The [Recommendations] tab displays the core findings that we believe are certain and relevant enough to support tangible recommendations. It also a communication example for each recommendation. While we have extensive experience working with risk communicators in this domain, we cannot know or define everything that might be relevent. We therefore urge risk communicators to carefully examine core findings on their own to see if there might be something of relevance that we are missing in the list of recommendations.

Bibliographic Archive 
=========================================

Column 
-----------------------------------------------------------------------

### Study Name {.no-title .no-padding data-height=30}

<span style="color: #4682B4;"> **Study:** </span> `r renderText(select_react() %>% pull(var = Citation))` </font> 

### Study Details {.no-title data-height=175}

<span style="color: #4682B4;"> **Abstract:** </span> `r renderText(select_react() %>% pull(var = Abstract))`

<span style="color: #4682B4;"> **Internal Validity:** </span> `r renderText(select_react() %>% pull(var = int))`/3 | 
<span style="color: #4682B4;"> **External Validity:** </span> `r renderText(select_react() %>% pull(var = ext))`/3 | 
<span style="color: #4682B4;"> **Domain Validity:** </span> `r renderText(select_react() %>% pull(var = dom))`/3

<!-- Makes the DOI a hyperlink -->
<span style="color: #4682B4;"> **DOI:** </span> `r renderUI({a(select_react() %>% pull(var = DOI), href = paste0("https://doi.org/", select_react() %>% pull(var = DOI)))})`

### Bibliographic Archive {.no-title}
```{r}
# Renders the full list of studies. Also acts as the input for the Study Details table above.
font.size <- "10pt"
DT::datatable(data %>% select(Study, 
                              `Summary of Findings`, 
                              `Topic(s)`, 
                              `Internal Validity` = int, 
                              `External Validity` = ext, 
                              `Domain Validity` = dom),
              filter = "top",
              selection = "single",
              rownames = FALSE,
              style = "bootstrap",
              class = "compact",
              options = list(dom = "Blrtip", 
                             initComplete = htmlwidgets::JS("function(settings, json) {", 
                                                            paste0("$(this.api().table().container()).css({'font-size': '", 
                                                                   font.size, "'});"),"}")), # governs text size
              elementId = 'table1')

# This adds a new variable that indexes the position of each study in the dataset as it appears in the datatable. This is so that we can match the study up to the row number returned by input$table1_row_last_clicked later.

data <- data %>% mutate(tableNumber = c(1:nrow(data)))

# This creates the reactive version of our dataframe, w/ only the columns we want displayed. The if / else statement is there so that the default text is displayed before the user clicks a study on the datatable.

# select_react <- reactive({
# 
#   if(is.null(input$table1_row_last_clicked)){
#     
#     # This is the dataframe that is returned when input$table1_row_last_clicked = NA (on page load, before clicking the table)
#     data.frame(Study = "Click on one of the studies below to learn more!", 
#                Abstract = "None", 
#                DOI = "None", 
#                int = "0", 
#                ext = "0", 
#                dom = "0", 
#                stringsAsFactors = FALSE)
#     
#   } else {
#     
#   data %>%
#       filter(tableNumber == input$table1_row_last_clicked) %>%
#       select(Study, Abstract, DOI, int, ext, dom) %>% 
#       mutate(DOI = paste0("https://doi.org/", DOI))
#       
#   }
# })

# I usually try to populate things with the first observation to show readers what it looks like.

select_react <- reactive({

  if(
    
    is.null(input$table1_row_last_clicked)){
    data %>%
      filter(tableNumber == 1) %>%
      select(Study, Citation = `Full Citation`, Abstract, DOI, int, ext, dom)

  } else {

  data %>%
      filter(tableNumber == input$table1_row_last_clicked) %>%
      select(Study, Citation = `Full Citation`, Abstract, DOI, int, ext, dom)
  }
})
```

State of the Literature {.storyboard}
=========================================

### We are able to identify eight common topics in the literature on risk communication using probability information. *Formats & Framing* is the most frequent topic of study.

```{r}
topic_frequency <- data %>% 
#  filter(`Study ID` == "01") %>%  # this line make the chart reflect only unique papers, not unique studies within those papers.
  select(`Formats / Framing`:`Other / Misc.`) %>% 
  summarise_all(mean) %>% 
  gather(topic, prop)

topic_frequency$topic <- factor(topic_frequency$topic, levels = topic_frequency$topic,
                                labels = c("Formats &\nFraming", "Verbal\nExpressions", "Visualizations", 
                                           "General\nUnderstanding", "Prob. vs. Det.", "Opinions &\nPerceptions", 
                                           "Small &\nLong-term Risks", "Affect &\nEmotion", "Other\nMisc."))

propPlot <- ggplot(topic_frequency, aes(x = topic, 
                                        y = prop, 
                                        fill = prop, 
                                        text = paste0("Topic: ", topic, "<br>", 
                                                      "Proportion of Studies: ", round(prop, 2) * 100, "%"))) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = scales::percent, limits = c(0, 0.35)) + 
  labs(y = "Studies (%)", x = "Study Topic") +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text(size = 12)) +
  guides(fill = FALSE) +
  scale_fill_viridis_c()

renderPlotly({
  ggplotly(propPlot, tooltip = c("text")) %>%
    layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE))
})
```

***

The common topics are:

1. **General Understanding**:
2. **Verbal Expressions**:
3. **Formats / Framing**:
4. **Visualizations**:
5. **Prob. vs. Det**:
6. **Opinions / Perceptions**:
7. **Affect / Emotion**:
8. **Small / Long-term risk**:

### Sentence.

```{r}
# topic plot
```

***

Commentary:

- Text
- Text
- Text

Core Findings {data-orientation=rows}
=========================================

Row {data-height=75}
-----------------------------------------

### Finding {.no-title}
```{r}
renderText({
  finding_react() %>%
    pull(var = Recomendation)
})


```

Row {data-height=150}
-------------------------------------------

### Relevant Topics
```{r}
renderText({
  finding_react() %>%
    pull(var = Topic)
})


```


### Average Strength of Supporting Evidence
```{r}



```

### Number of Contradicting Studies
```{r}



```


Row
-----------------------------------------

### Complete List of Core Findings

```{r}

data.findings <- data.findings %>% mutate(tableNumber = c(1:nrow(data.findings)))

data.findings %>%
  select(Recomendation, Topic) %>%
  DT::datatable(., filter = "top",
              selection = "single",
              rownames = FALSE,
              style = "bootstrap",
              class = "compact",
              options = list(dom = "Blrtip", 
                             initComplete = htmlwidgets::JS("function(settings, json) {", 
                                                            paste0("$(this.api().table().container()).css({'font-size': '", 
                                                                   font.size, "'});"),"}")), # governs text size
              elementId = 'findingTable')

finding_react <- reactive({

  if(
    
    is.null(input$findingTable_row_last_clicked)){
    data.findings %>%
      filter(tableNumber == 1) %>%
      select(Recomendation, Topic)

  } else {

  data.findings %>%
      filter(tableNumber == input$findingTable_row_last_clicked) %>%
      select(Recomendation, Topic)
  }
})

```


Recommendations {.storyboard}
=========================================

### 1. Use probability information in lieu of deterministic information.

<font size=3.5px>

**Recommendation #1:** Use probability information in lieu of deterministic information.

**Confidence:** High.

**Supporting studies:** Jones 2018; Smith 2020.

**Example:** 

- **Replace**: Watch out! These storms will cause heavy downpours and flooding.
- **With**: Watch out! There is an extremely high (90-95%) chance that these storms will cause heavy downpours and flooding.

</font>

***

Commentary:

- Feature quote:


